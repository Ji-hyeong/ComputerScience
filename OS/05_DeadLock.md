[TOC]

# DeadLock

>2020.10.25



## 1. DeadLock

> 프로세스가 자원을 할당받지 못해 처리하지 못하는 상태를 말한다.



### 1.1 DeadLock이 발생하는 경우

![image-20201025144112314](C:\Users\qmffn\Desktop\ComputerScience\OS\img\DeadLock)

> [출처 : https://includestdio.tistory.com/12]

- 프로세스 1,2가 자원 1,2를 모두 할당받아야 한다고 가정
- 프로세스 1은 자원 1을, 프로세스 2는 자원 2를 할당받음.
- 프로세서 1은 자원 2를, 르로세스 2는 자원 1을 기다린다.
- **서로 요청한 자원이 다른 프로세스에 할당되어 있기 때문에 두 프로세스는 무기한으로 기다리게 된다. 이를 DeadLock(교착상태)라고 한다.**



### 1.2 DeadLock 발생 조건

> 4가지의 조건이 모두 성립해야 데드락이 발생한다.



1. 상호 배제 : 자원은 한 번에 한 프로세스만 사용할 수 있다.
2. 점유 대기 : 최소한 하나의 자원을 점유하고 있으면서 다른 프로세스에서 사용 중인 자원을 추가로 점유하기 위해 대기하는 프로세스가 있어야 한다. (1.1의 예시 상황과 동일)
3. 비선점 : 어느 프로세스에 의해 점유된 자원은 release하기 전까지 강제로 빼앗아 사용할 수 없다.
4. 순환 대기 : 프로세스의 집합 {P0, P1, P2, ... , Pn}에서 Pn-1은 Pn이 점유한 자원을 대기하며, Pn은 P0가 점유한 자원을 요구해야 한다.



### 1.3 DeadLock solution



1. 교착 상태 예방 및 회피 : 교착 상태가 되지 않도록 하기 위하여 교착 상태를 예방하거나 회피하는 프로토콜을 이용하는 방법
2. 교착 상태 탐지 및 회복 : 교착 상태가 되도록 허용한 다음에 회복시키는 방법

3. 교착 상태 무시 : 대부분의 시스템은 교착 상태가 잘 발생하지 않으며, 교착상태 예방, 회피, 탐지, 복구하는 것은 비용이 많이 든다.



- 교착상태 예방

  > 교착 상태 발생 조건 중 하나를 제거함으로써 해결하는 방법이지만, 자원낭비가 심하다.

  | 교착상태 발생 조건 |                          처리 방법                           |
  | :----------------: | :----------------------------------------------------------: |
  |   상호배제 부정    |   여러 개의 프로세스가 공유 자원을 사용할 수 있도록 한다.    |
  |   점유대기 부정    |     프로세스가 실행되기 전 필요한 모든 자원을 할당한다.      |
  |    비선점 부정     | 자원을 점유하고 있는 프로세스가 다른 자원을 필요로 할 때, 가지고 있는 자원을 반납하고 자원을 점유하고 있지 않은 상태로 필요한 자원을 사용하기 위해 기다린다. |
  |   순환대기 부정    | 자원에 고유한 번호를 할당하고, 번호 순서대로 자원을 요구하도록 한다. |

  

- 교착상태 회피

  > 교착 상태가 발생하면 피해나가는 방법이다.

  - 은행원 알고리즘 : 다익스트라가 제안한 방법으로, 은행에서 모든 고객의 요구가 충족되도록 현금을 할당하는 데에서 유래한 방법이다.
    - 프로세스가 자원을 요구할 때 시스템은 자원을 할당한 후에도 교착 상태가 되지 않는지 사전에 확인하여 교착 상태를 회피하는 방법이다. 교착 상태가 되지 않는다면 자원을 할당하고, 그렇지 않으면 다른 프로세스들이 자원을 반납할 때까지 대기한다.

- 교착상태 회복

  > 교착 상태를 일으킨 프로세스를 종료하거나, 할당된 자원을 해제함으로써 회복하는 것을 의미한다.

  - 프로세스 종료 : 교착 상태의 프로세스를 모두 중지하거나, 교착 상태가 제거될 때까지 한 프로세스 씩 중지시킨다.
  - 자원 선점 : 교착 상태의 프로세스가 점유하고 있는 자원을 선점하여 다른 프로세스에게 할당되며, 해당 프로세스를 일시 정지시키거나, 우선 순위가 낮은 프로세스, 실행된 횟수가 적은 프로세서 등을 위주로 프로세스의 자원을 선점한다. 



**[참고]**

- https://github.com/gyoogle/tech-interview-for-developer/blob/master/Computer%20Science/Operating%20System/Operation%20System.md